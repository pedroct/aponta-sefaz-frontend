<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8" />
    <title>Apontar Tempo - Menu Handler</title>
    <script type="text/javascript" src="../../lib/VSS.SDK.min.js"></script>
</head>
<body>
    <script type="text/javascript">
        // Inicializa√ß√£o simples
        VSS.init();
        
        VSS.ready(function() {
            console.log("‚úÖ Aponta: Menu handler inicializado");
            
            // Registrar o handler do menu action
            VSS.register(VSS.getContributionId(), function(context) {
                console.log("üìã Aponta: Menu action handler registrado", context);
                
                return {
                    execute: function(actionContext) {
                        console.log("üîî Aponta: A√ß√£o executada!", actionContext);
                        
                        // Extrair work item ID
                        var workItemId = actionContext.workItemId || 
                                         actionContext.id || 
                                         (actionContext.workItemIds && actionContext.workItemIds[0]);
                        
                        if (!workItemId) {
                            alert("Erro: Work Item n√£o encontrado");
                            return;
                        }
                        
                        if (actionContext.workItemIds && actionContext.workItemIds.length > 1) {
                            alert("Por favor, selecione apenas um work item para apontar tempo.");
                            return;
                        }
                        
                        console.log("üìç Aponta: Abrindo dialog para Work Item ID:", workItemId);
                        
                        // Obter servi√ßo de dialog
                        VSS.getService(VSS.ServiceIds.Dialog).then(function(dialogService) {
                            var extensionCtx = VSS.getExtensionContext();
                            
                            // Contribution ID completo
                            var contributionId = extensionCtx.publisherId + 
                                "." + extensionCtx.extensionId + 
                                ".addApontaTimeDialog";
                            
                            console.log("üìç Aponta: Contribution ID:", contributionId);
                            
                            // Op√ß√µes do dialog
                            var dialogOptions = {
                                title: "Apontar Tempo",
                                width: 500,
                                height: 600,
                                resizable: false,
                                buttons: null,
                                urlReplacementObject: { id: workItemId }
                            };
                            
                            // Abrir dialog
                            dialogService.openDialog(contributionId, dialogOptions).then(function(dialog) {
                                console.log("‚úÖ Aponta: Dialog aberto com sucesso");
                            }, function(error) {
                                console.error("‚ùå Aponta: Erro ao abrir dialog:", error);
                                alert("Erro ao abrir formul√°rio: " + (error.message || error));
                            });
                        }, function(error) {
                            console.error("‚ùå Aponta: Erro ao obter DialogService:", error);
                        });
                    }
                };
            });
            
            console.log("‚úÖ Aponta: Menu action handler pronto");
        });
    </script>
</body>
</html>
