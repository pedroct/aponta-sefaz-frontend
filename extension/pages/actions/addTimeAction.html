<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Add Time Action</title>
    <script src="https://vsscode.dev/scripts/VSS.SDK.js"></script>
</head>
<body>
    <script>
        VSS.init({ 
            usePlatformScripts: true,
            explicitNotifyLoaded: true
        });

        VSS.ready(function() {
            try {
                // Obter contexto
                const webContext = VSS.getWebContext();
                const extensionContext = VSS.getExtensionContext();

                console.log('‚úÖ Action Provider pronto');

                // Registrar a√ß√£o
                VSS.register(VSS.getContributionId(), {
                    getMenuItems: function(context) {
                        // context.workItem cont√©m os dados do item
                        return [{
                            title: "‚è±Ô∏è Apontar Tempo",
                            action: function(context) {
                                openAddTimeDialog(context.id);
                            },
                            disabled: false
                        }];
                    }
                });

                VSS.notifyLoadSucceeded();

            } catch (error) {
                console.error('‚ùå Erro:', error);
                VSS.notifyLoadFailed(error);
            }
        });

        function openAddTimeDialog(workItemId) {
            console.log('üîî Abrindo dialog para work item:', workItemId);

            try {
                const baseUri = VSS.getExtensionContext().baseUri;
                const dialogUrl = `${baseUri}pages/addTimePopupDialog/index.html?workItemId=${workItemId}`;

                console.log('üìç Dialog URL:', dialogUrl);

                const dialogOptions = {
                    title: "‚è±Ô∏è Apontar Tempo",
                    width: 600,
                    height: 700,
                    buttons: []
                };

                // Abrir dialog via VSS Service
                VSS.getService(VSS.ServiceIds.Dialog).then(function(dialogService) {
                    dialogService.openDialog(dialogUrl, dialogOptions).then(function() {
                        console.log('‚úÖ Dialog aberto com sucesso');
                    });
                });

            } catch (error) {
                console.error('‚ùå Erro ao abrir dialog:', error);
                alert('Erro ao abrir modal: ' + error.message);
            }
        }
    </script>
</body>
</html>
